name: Daily Google Sheets Scheduler

on:
  schedule:
    - cron: "0 * * * *"   # tiap jam (UTC)
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Build docker scheduler image
        run: docker build -f docker/Dockerfile.scheduler -t sheets-scheduler .

      - name: Create Google service account file
        run: |
          cat << 'EOF' > service_account.json
          ${{ secrets.GOOGLE_CREDS }}
          EOF

      - name: Debug creds file
        run: |
          ls -lah service_account.json
          head -n 3 service_account.json

      - name: Run scheduler container
        run: |
          docker run --rm \
            -v ${{ github.workspace }}/service_account.json:/app/service_account.json \
            sheets-scheduler